// .docs-espejo/lib/i18n.ts.md
/\*\*

- @file i18n.ts.md
- @description Documento Espejo y SSoT conceptual para el Ensamblador de Diccionarios del Portal.
- @version 1.0.0
- @author RaZ Podestá - MetaShark Tech
  \*/

# Manifiesto Conceptual: Ensamblador de Diccionarios del Portal

## 1. Rol Estratégico

El aparato `lib/i18n.ts` es el **ensamblador de contenido soberano para el dominio del Portal**. Su única responsabilidad es descubrir, cargar, fusionar y validar todos los fragmentos de contenido (`.i18n.json`) necesarios para construir el diccionario completo (`Dictionary`) para un `locale` específico.

Funciona como una factoría de contenido que abstrae por completo la complejidad de la estructura de archivos de los componentes de página que lo consumen.

## 2. Arquitectura y Flujo de Ejecución (Refactorizada)

La arquitectura se basa en el **descubrimiento dinámico de módulos**, eliminando el mantenimiento manual y haciéndola auto-adaptable.

1.  **Entrada:** Recibe un `locale` (ej. "es-ES").
2.  **Paso 1: Descubrimiento Automático de Archivos (`getI18nFilePaths`)**
    - Una función interna escanea de forma recursiva los directorios `messages/components/`, `messages/pages/` y `components/razBits/`.
    - Busca todos los archivos que coincidan con el patrón `*.i18n.json`.
    - Devuelve un array con las rutas absolutas de todos los archivos de contenido descubiertos.
3.  **Paso 2: Carga y Fusión Dinámica (`getDictionary`)**
    - La función principal, `getDictionary`, utiliza la lista de rutas generada.
    - Itera sobre cada ruta y carga su contenido dinámicamente usando `import()`.
    - Para cada módulo cargado, extrae el objeto de contenido correspondiente al `locale` solicitado.
    - Fusiona (`merge`) todos los objetos de contenido en un único gran objeto de diccionario.
4.  **Paso 3: Validación por Contrato**
    - El diccionario fusionado se valida contra el schema ensamblador global `i18nSchema`.
    - Si la validación falla, se lanza un error detallado en tiempo de build, previniendo la entrega de una página con contenido corrupto o faltante.
5.  **Paso 4: Cacheo y Salida**
    - El diccionario validado se almacena en una caché en memoria (`dictionariesCache`) para evitar el reprocesamiento en solicitudes posteriores para el mismo `locale` durante el mismo ciclo de build/render.
    - Devuelve el `Dictionary` completo y validado.

## 3. Contrato de API

- **Función Principal:** `getDictionary(locale: string): Promise<Dictionary>`
- **Retorna:** `Promise<Dictionary>` - Una promesa que resuelve con el objeto de diccionario completo.
- **Lanza (`@throws`):** Un `Error` si la validación del contenido contra el schema falla.

## 4. Zona de Melhorias Futuras

- **Optimización del Descubrimiento:** En lugar de escanear el sistema de archivos en cada llamada en desarrollo, el resultado del escaneo podría ser cacheado. En producción (build), el escaneo solo se ejecuta una vez.
- **Soporte para Namespaces de Contenido:** Extender la lógica para permitir cargar solo subconjuntos del diccionario (ej. `getDictionary(locale, ['header', 'footer'])`) para páginas muy ligeras que no necesiten todo el contenido, optimizando la memoria.
- **Integración con CMS:** Reemplazar el escaneo del sistema de archivos con una llamada a una API de un CMS Headless para obtener los fragmentos de contenido, haciendo la gestión de contenido completamente externa a la base de código.

// .docs-espejo/lib/i18n.ts.md
