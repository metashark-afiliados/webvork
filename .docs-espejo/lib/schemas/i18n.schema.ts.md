// .docs-espejo/lib/schemas/i18n.schema.ts.md
/\*\*

- @file i18n.schema.ts.md
- @description Documento Espejo y SSoT conceptual para el Ensamblador de Schemas i18n.
- @version 1.0.0
- @author RaZ Podestá - MetaShark Tech
  \*/

# Manifiesto Conceptual: Ensamblador de Schemas i18n

## 1. Rol Estratégico

El aparato `lib/schemas/i18n.schema.ts` es el **Guardián del Contrato de Datos Global**. Su única responsabilidad es construir dinámicamente un único y monolítico schema de Zod (`i18nSchema`) que representa la estructura completa de un diccionario de contenido para un solo `locale`.

Este schema ensamblado es la SSoT para la validación de contenido en toda la aplicación. Se utiliza tanto en el `getDictionary` del portal como en el `processCampaignData` de las campañas para garantizar que cualquier contenido que se intente cargar cumpla rigurosamente con el contrato de datos esperado por los componentes de UI. Falla la validación, falla el build/render, previniendo así errores en producción.

## 2. Arquitectura y Flujo de Ejecución

La arquitectura se basa en el **descubrimiento y composición dinámica de módulos de schema**, reflejando la misma filosofía del ensamblador de diccionarios.

1.  **Paso 1: Descubrimiento Automático de Archivos de Schema (`getSchemaFilePaths`)**
    - Una función interna escanea de forma recursiva los directorios `lib/schemas/components/`, `lib/schemas/pages/`, y `components/razBits/`.
    - Busca todos los archivos que coincidan con el patrón `*.schema.ts`.
    - Devuelve un array con las rutas de módulo para la importación dinámica.
2.  **Paso 2: Carga, Extracción y Fusión Dinámica (`buildI18nSchema`)**
    - Esta función asíncrona es el corazón del ensamblador.
    - Itera sobre las rutas de archivos descubiertas e importa cada módulo de schema.
    - De cada módulo, extrae el objeto de schema exportado (por convención, `...LocaleSchema`).
    - Utiliza el método `.merge()` de Zod para fusionar iterativamente cada schema individual en un único schema maestro (`i18nSchema`).
3.  **Paso 3: Cacheo y Exportación**
    - El schema maestro ensamblado es un objeto complejo. Para evitar reconstruirlo en cada importación (especialmente en desarrollo), el resultado de `buildI18nSchema` se invoca una vez y se exporta como una constante (`i18nSchema`). El sistema de módulos de Node.js se encarga de cachear esta constante.
    - Se exporta tanto el `i18nSchema` ensamblado como el tipo `Dictionary` inferido de él.

## 3. Contrato de API

- **Exportación principal:** `i18nSchema: z.ZodObject<...>` - El schema de Zod final y ensamblado.
- **Exportación de tipo:** `Dictionary: z.infer<typeof i18nSchema>` - El tipo TypeScript global para un diccionario de contenido validado.

## 4. Zona de Melhorias Futuras

- **Generación de Schemas en Tiempo de Build:** En lugar de ensamblar el schema dinámicamente en tiempo de ejecución, un script dedicado en el proceso de build (`pnpm run build`) podría realizar el descubrimiento y generar un archivo `i18n.schema.generated.ts` estático. Esto movería la complejidad del tiempo de ejecución al tiempo de build, resultando en un arranque de servidor potencialmente más rápido.
- **Validación de Consistencia de Claves:** Implementar una validación que asegure que no haya colisiones de claves de nivel superior entre los diferentes archivos de schema para prevenir sobreescrituras accidentales durante la fusión.
- **Documentación de Schema Automática:** Crear un script que consuma el `i18nSchema` final y genere documentación en Markdown de la estructura de datos completa del diccionario, sirviendo como una guía para los gestores de contenido.

// .docs-espejo/lib/schemas/i18n.schema.ts.md
